<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notion Hosts ç®¡ç†å™¨</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.glass-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
}

.gradient-text {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.status-badge {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: .7;
    }
}

textarea:focus { 
    outline: none !important; 
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important; 
}

input[type="number"]:focus,
input[type="checkbox"]:focus {
    outline: none !important;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
}

.log-container {
    background: #1a1a1a;
    color: #00ff88;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 13px;
    line-height: 1.6;
}

.log-container::-webkit-scrollbar {
    width: 8px;
}

.log-container::-webkit-scrollbar-track {
    background: #2a2a2a;
}

.log-container::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
}

.log-container::-webkit-scrollbar-thumb:hover {
    background: #777;
}

.feature-card {
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
}

.domain-card {
    transition: all 0.2s ease;
}

.domain-card:hover {
    background: #f8f9ff !important;
    transform: scale(1.02);
}

.fade-in {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 13px;
    font-weight: 600;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
#timeline::-webkit-scrollbar {
    width: 8px;
}
#timeline::-webkit-scrollbar-thumb {
    background: #e5e7eb;
    border-radius: 4px;
}
#timeline::-webkit-scrollbar-track {
    background: #fff;
}
</style>
</head>
<body class="min-h-screen py-8 px-4">
<div class="w-full max-w-6xl mx-auto space-y-6">
    
    <!-- å¤´éƒ¨ä»‹ç»åŒºåŸŸ -->
    <div class="glass-card rounded-2xl p-8 fade-in">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
            <div class="text-center md:text-left">
                <h1 class="text-5xl font-bold gradient-text mb-3">Notion Hosts ç®¡ç†å™¨</h1>
                <p class="text-gray-600 text-lg">æ™ºèƒ½åŠ é€Ÿ Notion è®¿é—®ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€å¿« IP</p>
                <div class="flex flex-wrap gap-3 mt-4 justify-center md:justify-start">
                    <span class="px-3 py-1 rounded-full text-sm bg-gradient-to-r from-green-100 to-green-200 text-green-800 flex items-center gap-2">
                        <span class="w-2.5 h-2.5 bg-green-500 rounded-full status-badge"></span> æœåŠ¡è¿è¡Œä¸­
                    </span>
                    <span class="px-3 py-1 rounded-full text-sm bg-gradient-to-r from-indigo-100 to-indigo-200 text-indigo-800 flex items-center gap-2">
                        âš¡ è‡ªåŠ¨æ£€æµ‹ / æ‰‹åŠ¨è§¦å‘
                    </span>
                    <span class="px-3 py-1 rounded-full text-sm bg-gradient-to-r from-amber-100 to-amber-200 text-amber-800 flex items-center gap-2">
                        ğŸ›¡ï¸ hosts è‡ªåŠ¨å¤‡ä»½
                    </span>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                <div class="flex-1 sm:flex-none sm:w-48 p-4 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-600 text-white shadow-lg">
                    <div class="text-sm text-white/80 mb-1">è¿è¡ŒçŠ¶æ€</div>
                    {% if status.last_run %}
                    <div class="text-xl font-bold flex items-center gap-2">åœ¨çº¿ <span class="w-2 h-2 bg-emerald-300 rounded-full status-badge"></span></div>
                    <div class="text-xs text-white/80 mt-1">æœ€è¿‘æ£€æµ‹ï¼š{{ status.last_run }}</div>
                    {% else %}
                    <div class="text-xl font-bold flex items-center gap-2">å¾…æ£€æµ‹ <span class="w-2 h-2 bg-amber-300 rounded-full status-badge"></span></div>
                    <div class="text-xs text-white/80 mt-1">å°šæœªæ‰§è¡Œæ£€æµ‹</div>
                    {% endif %}
                </div>
                <div class="flex-1 sm:flex-none sm:w-48 p-4 rounded-2xl bg-white/70 border border-white/60 shadow-lg">
                    <div class="text-sm text-gray-600 mb-1">å½“å‰ IP</div>
                    {% if status.last_ip %}
                    <div class="text-2xl font-bold text-gray-900">{{ status.last_ip }}</div>
                    <div class="mt-2 flex items-center gap-2 text-xs text-gray-600">
                        <span class="w-2.5 h-2.5 bg-emerald-500 rounded-full status-badge"></span> åŠ é€Ÿç”Ÿæ•ˆ
                    </div>
                    {% else %}
                    <div class="text-lg font-semibold text-amber-700">æœªæ£€æµ‹</div>
                    <p class="text-xs text-gray-600 mt-2">ç‚¹å‡»â€œæ‰‹åŠ¨è§¦å‘â€ç«‹å³æ£€æµ‹</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½ä»‹ç» -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
            <div class="feature-card bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 border border-blue-100">
                <div class="text-3xl mb-3">ğŸš€</div>
                <h3 class="font-semibold text-gray-800 mb-2">è‡ªåŠ¨æ£€æµ‹</h3>
                <p class="text-sm text-gray-600">è‡ªåŠ¨æµ‹è¯•å¤šä¸ª IP åœ°å€ï¼Œæ™ºèƒ½é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„èŠ‚ç‚¹</p>
            </div>
            <div class="feature-card bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-5 border border-purple-100">
                <div class="text-3xl mb-3">âš¡</div>
                <h3 class="font-semibold text-gray-800 mb-2">å®æ—¶æ›´æ–°</h3>
                <p class="text-sm text-gray-600">æ”¯æŒå®šæ—¶è‡ªåŠ¨æ£€æµ‹ï¼Œä¿æŒæœ€ä½³è®¿é—®é€Ÿåº¦</p>
            </div>
            <div class="feature-card bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-5 border border-green-100">
                <div class="text-3xl mb-3">ğŸ›¡ï¸</div>
                <h3 class="font-semibold text-gray-800 mb-2">å®‰å…¨å¯é </h3>
                <p class="text-sm text-gray-600">è‡ªåŠ¨å¤‡ä»½ hosts æ–‡ä»¶ï¼Œæ“ä½œå®‰å…¨æœ‰ä¿éšœ</p>
            </div>
        </div>

        <!-- å½“å‰çŠ¶æ€ -->
        {% if status.last_ip %}
        <div class="mt-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
            <div class="flex items-center justify-between">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="status-badge w-3 h-3 bg-green-500 rounded-full"></span>
                        <span class="font-semibold text-gray-800">å½“å‰ä½¿ç”¨ IP</span>
                    </div>
                    <p class="text-2xl font-bold text-gray-900">{{ status.last_ip }}</p>
                    {% if status.last_run %}
                    <p class="text-sm text-gray-600 mt-1">æœ€åæ›´æ–°: {{ status.last_run }}</p>
                    {% endif %}
                </div>
                <div class="text-4xl">âœ…</div>
            </div>
        </div>
        {% else %}
        <div class="mt-6 p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl border border-yellow-200">
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-semibold text-gray-800 mb-1">å°šæœªæ‰§è¡Œæ£€æµ‹</p>
                    <p class="text-sm text-gray-600">ç‚¹å‡»"æ‰‹åŠ¨è§¦å‘"æŒ‰é’®å¼€å§‹æ£€æµ‹æœ€å¿« IP</p>
                </div>
                <div class="text-4xl">â³</div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- IP é…ç½®å¡ç‰‡ -->
    <div class="glass-card rounded-2xl p-6 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">1</div>
            <div>
                <h2 class="text-2xl font-bold text-gray-800">IP åœ°å€åˆ—è¡¨</h2>
                <p class="text-gray-600 text-sm">æ¯è¡Œè¾“å…¥ä¸€ä¸ª IP åœ°å€ï¼Œç¨‹åºä¼šè‡ªåŠ¨æµ‹è¯•è¿™äº› IP çš„å¯ç”¨æ€§å’Œå»¶è¿Ÿ</p>
            </div>
        </div>
        <textarea id="ips" class="w-full h-40 p-4 border-2 border-gray-200 rounded-xl font-mono text-sm resize-none focus:border-indigo-500 transition-colors" placeholder="ä¾‹å¦‚ï¼š&#10;119.28.13.121&#10;154.40.44.47&#10;101.32.183.34">{{ ips|join('\n') }}</textarea>
        <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
            <span>ğŸ’¡</span>
            <span>å»ºè®®æ·»åŠ å¤šä¸ª IP åœ°å€ä»¥æé«˜æ£€æµ‹æˆåŠŸç‡ï¼Œç¨‹åºä¼šé€‰æ‹©å»¶è¿Ÿæœ€ä½çš„ IP</span>
        </p>
    </div>

    <!-- åŸŸåé…ç½®å¡ç‰‡ -->
    <div class="glass-card rounded-2xl p-6 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">2</div>
            <div>
                <h2 class="text-2xl font-bold text-gray-800">åŸŸåé…ç½®</h2>
                <p class="text-gray-600 text-sm">é€‰æ‹©éœ€è¦åŠ é€Ÿçš„ Notion ç›¸å…³åŸŸåï¼Œå‹¾é€‰çš„åŸŸåå°†è¢«æ·»åŠ åˆ° hosts æ–‡ä»¶</p>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        {% for d in domains %}
            <div class="domain-card flex items-start justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                <div class="flex items-start gap-3 flex-1">
                    <input type="checkbox" id="dom_{{ loop.index }}" class="mt-1 w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer" {% if d.checked %}checked{% endif %} value="{{ d.name }}">
                    <div class="flex-1">
                        <label class="font-semibold text-gray-800 cursor-pointer block" for="dom_{{ loop.index }}">{{ d.name }}</label>
                        {% if d.desc %}
                        <p class="text-xs text-gray-500 mt-1">{{ d.desc }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>
    </div>

    <!-- è‡ªåŠ¨æ£€æµ‹é…ç½®å¡ç‰‡ -->
    <div class="glass-card rounded-2xl p-6 fade-in">
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">3</div>
            <div>
                <h2 class="text-2xl font-bold text-gray-800">è‡ªåŠ¨æ£€æµ‹è®¾ç½®</h2>
                <p class="text-gray-600 text-sm">è®¾ç½®è‡ªåŠ¨æ£€æµ‹é—´éš”ï¼Œç¨‹åºä¼šå®šæœŸæ£€æµ‹å¹¶æ›´æ–°åˆ°æœ€å¿«çš„ IP</p>
            </div>
        </div>
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
            <div class="flex items-center gap-4">
                <label class="font-semibold text-gray-800 whitespace-nowrap">æ£€æµ‹é—´éš”ï¼ˆç§’ï¼‰:</label>
                <input type="number" id="interval" value="{{ interval }}" min="0" class="w-32 p-3 border-2 border-gray-300 rounded-lg font-semibold text-center focus:border-indigo-500 transition-colors">
                <span class="text-sm text-gray-600">è®¾ç½®ä¸º 0 è¡¨ç¤ºç¦ç”¨è‡ªåŠ¨æ£€æµ‹</span>
            </div>
            <div class="flex gap-3 w-full md:w-auto">
                <button class="btn-primary text-white font-semibold px-8 py-3 rounded-xl flex-1 md:flex-none" onclick="saveConfig()">
                    ğŸ’¾ ä¿å­˜é…ç½®
                </button>
                <button class="btn-secondary text-white font-semibold px-8 py-3 rounded-xl flex-1 md:flex-none" onclick="runNow()">
                    âš¡ æ‰‹åŠ¨è§¦å‘
                </button>
            </div>
        </div>
        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-xl">
            <p class="text-sm text-gray-700 flex items-start gap-2">
                <span class="text-lg">âš ï¸</span>
                <span><strong>é‡è¦æç¤ºï¼š</strong>ä¿®æ”¹ hosts æ–‡ä»¶éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚è¯·ç¡®ä¿ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæ­¤ç¨‹åºï¼Œå¦åˆ™æ— æ³•æ›´æ–° hosts æ–‡ä»¶ã€‚</span>
            </p>
        </div>
    </div>

    <!-- æ—¥å¿— / çŠ¶æ€å¡ç‰‡ï¼ˆæ–°ç‰ˆç¾è§‚å±•ç¤ºï¼‰ -->
    <div class="glass-card rounded-2xl p-6 fade-in">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-gray-700 to-gray-900 rounded-lg flex items-center justify-center text-white font-bold text-lg">ğŸ“‹</div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">è¿è¡Œæ—¥å¿—</h2>
                    <p class="text-gray-600 text-sm">åŠ¨æ€æŸ¥çœ‹æœ€è¿‘çŠ¶æ€å’Œå†å²è¯¦æƒ…</p>
                </div>
            </div>
        </div>
        <div>
            <div class="font-semibold text-gray-700 mb-2 flex items-center gap-2 text-base"><span>ğŸ•’</span>æœ€è¿‘ 100 æ¡äº‹ä»¶</div>
            <div id="timeline" class="flex flex-col gap-2 h-60 overflow-y-auto"></div>
        </div>
    </div>
    <script id="logs-data" type="application/json">{{ status.logs|tojson }}</script>

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <div class="glass-card rounded-2xl p-6 fade-in">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span>ğŸ“–</span>
            <span>ä½¿ç”¨è¯´æ˜</span>
        </h3>
        <div class="space-y-3 text-sm text-gray-700">
            <div class="flex items-start gap-3">
                <span class="font-bold text-indigo-600">1.</span>
                <p>åœ¨ IP åœ°å€åˆ—è¡¨ä¸­æ·»åŠ éœ€è¦æµ‹è¯•çš„ IP åœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª</p>
            </div>
            <div class="flex items-start gap-3">
                <span class="font-bold text-indigo-600">2.</span>
                <p>å‹¾é€‰éœ€è¦åŠ é€Ÿçš„ Notion åŸŸåï¼ˆå»ºè®®è‡³å°‘å‹¾é€‰ www.notion.soï¼‰</p>
            </div>
            <div class="flex items-start gap-3">
                <span class="font-bold text-indigo-600">3.</span>
                <p>è®¾ç½®è‡ªåŠ¨æ£€æµ‹é—´éš”ï¼ˆç§’ï¼‰ï¼Œ0 è¡¨ç¤ºç¦ç”¨è‡ªåŠ¨æ£€æµ‹</p>
            </div>
            <div class="flex items-start gap-3">
                <span class="font-bold text-indigo-600">4.</span>
                <p>ç‚¹å‡»"ä¿å­˜é…ç½®"ä¿å­˜è®¾ç½®ï¼Œç‚¹å‡»"æ‰‹åŠ¨è§¦å‘"ç«‹å³æ£€æµ‹å¹¶æ›´æ–°</p>
            </div>
            <div class="flex items-start gap-3">
                <span class="font-bold text-indigo-600">5.</span>
                <p>ç¨‹åºä¼šè‡ªåŠ¨å¤‡ä»½ hosts æ–‡ä»¶ï¼Œæ›´æ–°å‰ä¼šåˆ›å»ºå¤‡ä»½æ–‡ä»¶</p>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <div class="text-center text-white/80 text-sm py-4">
        <p>Notion Hosts ç®¡ç†å™¨ v1.0 | è®© Notion è®¿é—®æ›´å¿«æ›´ç¨³å®š</p>
    </div>
</div>

<script>
function saveConfig(){
    let ips = document.getElementById("ips").value;
    let interval = document.getElementById("interval").value;
    let domains = [];
    {% for d in domains %}
    if(document.getElementById("dom_{{ loop.index }}").checked){
        domains.push("{{ d.name }}");
    }
    {% endfor %}
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = "â³ ä¿å­˜ä¸­...";
    btn.disabled = true;
    
    fetch("/save_config", {
        method:"POST",
        body: new URLSearchParams({
            ips: ips,
            domains: domains.join("\n"),
            interval: interval
        })
    }).then(r=>r.json()).then(d=>{
        btn.innerHTML = originalText;
        btn.disabled = false;
        showNotification(d.msg, "success");
        // å»¶è¿Ÿåˆ·æ–°é¡µé¢ä»¥æ›´æ–°çŠ¶æ€
        setTimeout(() => location.reload(), 1000);
    }).catch(err => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        showNotification("ä¿å­˜å¤±è´¥: " + err.message, "error");
    });
}

function runNow(){
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = "â³ æ£€æµ‹ä¸­...";
    btn.disabled = true;
    
    fetch("/run_now", {method:"POST"}).then(r=>r.json()).then(d=>{
        btn.innerHTML = originalText;
        btn.disabled = false;
        if(d.fastest_ip) {
            showNotification("æ£€æµ‹å®Œæˆï¼æœ€å¿« IP: " + d.fastest_ip, "success");
        } else {
            showNotification("æ£€æµ‹å®Œæˆï¼Œä½†æœªæ‰¾åˆ°å¯ç”¨ IP", "warning");
        }
        if(Array.isArray(d.logs)) {
            window.__logsData = d.logs;
            renderTimeline();
        }
        // å»¶è¿Ÿåˆ·æ–°é¡µé¢ä»¥æ›´æ–°çŠ¶æ€
        setTimeout(() => location.reload(), 1500);
    }).catch(err => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        showNotification("æ£€æµ‹å¤±è´¥: " + err.message, "error");
    });
}

function showNotification(message, type = "success") {
    const notification = document.createElement("div");
    notification.className = `fixed top-4 right-4 px-6 py-4 rounded-xl shadow-lg z-50 fade-in ${
        type === "success" ? "bg-green-500 text-white" : 
        type === "error" ? "bg-red-500 text-white" : 
        "bg-yellow-500 text-white"
    }`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = "0";
        notification.style.transition = "opacity 0.3s";
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// è‡ªåŠ¨åˆ·æ–°æ—¥å¿—å’ŒçŠ¶æ€
setInterval(()=>{
    fetch("/").then(r=>r.text()).then(html=>{
        let div = document.createElement('div'); 
        div.innerHTML = html;
        let logsScript = div.querySelector('#logs-data');
        if(logsScript && logsScript.textContent) {
            try{
                window.__logsData = JSON.parse(logsScript.textContent);
                renderTimeline();
            }catch(e){}
        }
    });
}, 5000);

// é¡µé¢åŠ è½½åŠ¨ç”»
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.fade-in');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '1';
        }, index * 100);
    });

    const logsScript = document.getElementById('logs-data');
    if(logsScript && logsScript.textContent) {
        try{
            window.__logsData = JSON.parse(logsScript.textContent);
        }catch(e){
            window.__logsData = [];
        }
    } else {
        window.__logsData = [];
    }
    renderTimeline();
});

// æ ¹æ®æ—¥å¿—åŠ¨æ€ç”Ÿæˆã€Œæœ€è¿‘äº‹ä»¶ã€æ—¶é—´çº¿
function renderTimeline() {
    const timeline = document.getElementById('timeline');
    if(!timeline) return;

    const lines = (window.__logsData || [])
        .filter(line => typeof line === 'string' && line.trim())
        .slice(-100)  // å–æœ€è¿‘ 100 æ¡
        .reverse();  // æœ€æ–°åœ¨ä¸Š

    const levelMap = [
        { match: ['âœ…','å¯ç”¨','å·²æ›´æ–°','æˆåŠŸ'], color: 'bg-green-50 border-green-200 text-green-700', icon: 'âœ…' },
        { match: ['âš ','è­¦å‘Š','æ³¨æ„'], color: 'bg-yellow-50 border-yellow-200 text-yellow-700', icon: 'âš ï¸' },
        { match: ['âŒ','å¤±è´¥','é”™è¯¯','ä¸å¯ç”¨','å¼‚å¸¸'], color: 'bg-red-50 border-red-200 text-red-700', icon: 'âŒ' },
        { match: ['è‡ªåŠ¨ä»»åŠ¡','è§¦å‘'], color: 'bg-blue-50 border-blue-200 text-blue-700', icon: 'ğŸ•’' },
    ];

    const fragments = lines.map(line => {
        const level = levelMap.find(l => l.match.some(k => line.includes(k)));
        const color = level ? level.color : 'bg-gray-50 border-gray-200 text-gray-700';
        const icon = level ? level.icon : 'â„¹ï¸';

        // æ‹†åˆ†æ—¥å¿—è¡Œä¸ºæ—¶é—´æˆ³å’Œå†…å®¹(å‡å®šæ ¼å¼: [æ—¶é—´]å†…å®¹)ä¼˜åŒ–
        let timeHtml = "";
        let contentHtml = line;
        let match = line.match(/^\s*\[([^\]]{6,})\]\s*(.*)$/);
        if(match){
           timeHtml = `<span class="min-w-[110px] mr-2 text-xs text-gray-400 font-mono">${match[1]}</span>`;
           contentHtml = match[2];
        }

        return `
            <div class="border ${color} rounded-xl px-4 py-2 flex items-start gap-2 shadow-sm">
                <div class="text-xl leading-none pt-1">${icon}</div>
                <div class="flex flex-col min-w-0">
                   ${timeHtml ? '<div>' + timeHtml + '</div>' : ''}
                   <div class="text-sm leading-5 break-all">${contentHtml}</div>
                </div>
            </div>
        `;
    }).join('');

    timeline.innerHTML = fragments || '<p class="text-gray-500 text-sm">æš‚æ— æ—¥å¿—</p>';
}
</script>
</body>
</html>
